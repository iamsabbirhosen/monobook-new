{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///E:/MonoBook%20New%20Interface/monobook-new/src/ai/genkit.ts"],"sourcesContent":["import {genkit} from 'genkit';\r\nimport {googleAI} from '@genkit-ai/google-genai';\r\n\r\nexport const ai = genkit({\r\n  plugins: [googleAI()],\r\n  model: 'googleai/gemini-2.5-flash',\r\n});\r\n"],"names":[],"mappings":";;;AAAA;AAAA;AACA;AAAA;;;AAEO,MAAM,KAAK,CAAA,GAAA,uIAAA,CAAA,SAAM,AAAD,EAAE;IACvB,SAAS;QAAC,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD;KAAI;IACrB,OAAO;AACT","debugId":null}},
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///E:/MonoBook%20New%20Interface/monobook-new/src/ai/flows/explain-difficult-page.ts"],"sourcesContent":["'use server';\r\n\r\n/**\r\n * @fileOverview AI flow to explain a difficult page of a book.\r\n *\r\n * - explainDifficultPage - A function that explains the content of a difficult page.\r\n * - ExplainDifficultPageInput - The input type for the explainDifficultPage function.\r\n * - ExplainDifficultPageOutput - The return type for the explainDifficultPage function.\r\n */\r\n\r\nimport {ai} from '@/ai/genkit';\r\nimport {z} from 'genkit';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport { createWorker } from 'tesseract.js';\r\n\r\nconst ExplainDifficultPageInputSchema = z.object({\r\n  imageUrl: z.string().describe('The URL of the page image to analyze'),\r\n  prompt: z.string().describe('The prompt to send to Gemini'),\r\n  apiKey: z.string().describe('The Gemini API key'),\r\n});\r\nexport type ExplainDifficultPageInput = z.infer<typeof ExplainDifficultPageInputSchema>;\r\n\r\nconst ExplainDifficultPageOutputSchema = z.object({\r\n  explanation: z\r\n    .string()\r\n    .describe('The explanation of the page content in an easy-to-understand way.'),\r\n});\r\nexport type ExplainDifficultPageOutput = z.infer<typeof ExplainDifficultPageOutputSchema>;\r\n\r\nexport async function explainDifficultPage(\r\n  input: ExplainDifficultPageInput\r\n): Promise<ExplainDifficultPageOutput> {\r\n  return explainDifficultPageFlow(input);\r\n}\r\n\r\nconst analyzeImage = async (imageUrl: string, prompt: string, apiKey: string) => {\r\n  if (!apiKey || apiKey.trim() === '') {\r\n    throw new Error('Invalid API key: API key is required');\r\n  }\r\n  try {\r\n    // Extract bookId and page number from the URL\r\n    const urlParts = imageUrl.split('/');\r\n    const bookId = urlParts[urlParts.length - 2];\r\n    const fileName = urlParts[urlParts.length - 1];\r\n    \r\n    // Construct the file path relative to public directory\r\n    const fs = require('fs');\r\n    const path = require('path');\r\n    const imagePath = path.join(process.cwd(), 'public', 'pdfbooks', bookId, fileName);\r\n    \r\n    console.log('Reading image from:', imagePath);\r\n    \r\n    // Read the image file directly\r\n    const imageBuffer = fs.readFileSync(imagePath);\r\n    const base64Image = imageBuffer.toString('base64');\r\n    \r\n    console.log('Image loaded and converted to base64');\r\n    \r\n    const genAI = new GoogleGenerativeAI(apiKey);\r\n    const model = genAI.getGenerativeModel({ model: \"gemini-pro-vision\" });\r\n    \r\n    console.log('Image size:', imageBuffer.length, 'bytes');\r\n    \r\n    const imagePart = {\r\n      inlineData: {\r\n        data: base64Image,\r\n        mimeType: \"image/jpeg\"\r\n      },\r\n    };\r\n\r\n    console.log('Sending request to Gemini with prompt:', prompt);\r\n    const result = await model.generateContent([prompt, imagePart]);\r\n    const response = await result.response;\r\n    const text = response.text();\r\n    console.log('Received response from Gemini:', text.substring(0, 100) + '...'); // Show first 100 chars\r\n    \r\n    return text;\r\n  } catch (error) {\r\n    console.error('Error in analyzeImage:', error);\r\n    if (error instanceof Error) {\r\n      throw new Error(`Image analysis failed: ${error.message}`);\r\n    } else {\r\n      throw new Error('Image analysis failed: Unknown error');\r\n    }\r\n  }\r\n};\r\n\r\nconst blobToBase64 = (blob: Blob): Promise<string> => {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onloadend = () => {\r\n      if (typeof reader.result === 'string') {\r\n        resolve(reader.result.split(',')[1]);\r\n      } else {\r\n        reject(new Error('Failed to convert blob to base64'));\r\n      }\r\n    };\r\n    reader.onerror = reject;\r\n    reader.readAsDataURL(blob);\r\n  });\r\n};\r\n\r\nconst explainDifficultPageFlow = ai.defineFlow(\r\n  {\r\n    name: 'explainDifficultPageFlow',\r\n    inputSchema: ExplainDifficultPageInputSchema,\r\n    outputSchema: ExplainDifficultPageOutputSchema,\r\n  },\r\n  async input => {\r\n    const explanation = await analyzeImage(input.imageUrl, input.prompt, input.apiKey);\r\n    return { explanation };\r\n    return { explanation };\r\n  }\r\n);\r\n"],"names":[],"mappings":";;;;;AAEA;;;;;;CAMC,GAED;AACA;AAAA;AACA;;;;;;;AAKA,MAAM,kCAAkC,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC/C,UAAU,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC9B,QAAQ,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC5B,QAAQ,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;AAC9B;AAGA,MAAM,mCAAmC,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAChD,aAAa,uIAAA,CAAA,IAAC,CACX,MAAM,GACN,QAAQ,CAAC;AACd;AAGO,eAAe,qBACpB,KAAgC;IAEhC,OAAO,yBAAyB;AAClC;AAEA,MAAM,eAAe,OAAO,UAAkB,QAAgB;IAC5D,IAAI,CAAC,UAAU,OAAO,IAAI,OAAO,IAAI;QACnC,MAAM,IAAI,MAAM;IAClB;IACA,IAAI;QACF,8CAA8C;QAC9C,MAAM,WAAW,SAAS,KAAK,CAAC;QAChC,MAAM,SAAS,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE;QAC5C,MAAM,WAAW,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE;QAE9C,uDAAuD;QACvD,MAAM;QACN,MAAM;QACN,MAAM,YAAY,KAAK,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,YAAY,QAAQ;QAEzE,QAAQ,GAAG,CAAC,uBAAuB;QAEnC,+BAA+B;QAC/B,MAAM,cAAc,GAAG,YAAY,CAAC;QACpC,MAAM,cAAc,YAAY,QAAQ,CAAC;QAEzC,QAAQ,GAAG,CAAC;QAEZ,MAAM,QAAQ,IAAI,8JAAA,CAAA,qBAAkB,CAAC;QACrC,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YAAE,OAAO;QAAoB;QAEpE,QAAQ,GAAG,CAAC,eAAe,YAAY,MAAM,EAAE;QAE/C,MAAM,YAAY;YAChB,YAAY;gBACV,MAAM;gBACN,UAAU;YACZ;QACF;QAEA,QAAQ,GAAG,CAAC,0CAA0C;QACtD,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;YAAC;YAAQ;SAAU;QAC9D,MAAM,WAAW,MAAM,OAAO,QAAQ;QACtC,MAAM,OAAO,SAAS,IAAI;QAC1B,QAAQ,GAAG,CAAC,kCAAkC,KAAK,SAAS,CAAC,GAAG,OAAO,QAAQ,uBAAuB;QAEtG,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,IAAI,iBAAiB,OAAO;YAC1B,MAAM,IAAI,MAAM,CAAC,uBAAuB,EAAE,MAAM,OAAO,EAAE;QAC3D,OAAO;YACL,MAAM,IAAI,MAAM;QAClB;IACF;AACF;AAEA,MAAM,eAAe,CAAC;IACpB,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,SAAS,IAAI;QACnB,OAAO,SAAS,GAAG;YACjB,IAAI,OAAO,OAAO,MAAM,KAAK,UAAU;gBACrC,QAAQ,OAAO,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;YACrC,OAAO;gBACL,OAAO,IAAI,MAAM;YACnB;QACF;QACA,OAAO,OAAO,GAAG;QACjB,OAAO,aAAa,CAAC;IACvB;AACF;AAEA,MAAM,2BAA2B,mHAAA,CAAA,KAAE,CAAC,UAAU,CAC5C;IACE,MAAM;IACN,aAAa;IACb,cAAc;AAChB,GACA,OAAM;IACJ,MAAM,cAAc,MAAM,aAAa,MAAM,QAAQ,EAAE,MAAM,MAAM,EAAE,MAAM,MAAM;IACjF,OAAO;QAAE;IAAY;;AAEvB;;;IAnFoB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 407, "column": 0}, "map": {"version":3,"sources":["file:///E:/MonoBook%20New%20Interface/monobook-new/.next-internal/server/app/reader/%5BbookId%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {explainDifficultPage as '400af1c4f56dccc433ca992a8a235f7ce477aea65f'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 465, "column": 0}, "map": {"version":3,"sources":["file:///E:/MonoBook%20New%20Interface/monobook-new/src/app/reader/%5BbookId%5D/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/reader/[bookId]/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/reader/[bookId]/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAoS,GACjU,kEACA","debugId":null}},
    {"offset": {"line": 479, "column": 0}, "map": {"version":3,"sources":["file:///E:/MonoBook%20New%20Interface/monobook-new/src/app/reader/%5BbookId%5D/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/reader/[bookId]/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/reader/[bookId]/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAgR,GAC7S,8CACA","debugId":null}},
    {"offset": {"line": 493, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}